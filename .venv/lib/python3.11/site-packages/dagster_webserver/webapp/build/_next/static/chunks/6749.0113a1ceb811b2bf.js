"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6749],{46749:function(e,t,s){s.r(t),s.d(t,{MergedAutomationRoot:function(){return eZ},default:function(){return eV}});var n=s(52322),r=s(14934),o=s(45774),i=s(37483),a=s(35292),l=s(36853),c=s(39013),d=s(74580),u=s(74159),h=s(35002),p=s(2784),m=s(55010),x=s(60603),g=s(38491),j=s(15358),f=s(34147),y=s(92506),S=s(20958),v=s(71406);let w={step:"initial",completion:{completed:0,errors:{}}},b=(e,t)=>{switch(t.type){case"reset":return w;case"start":return{...e,step:"updating"};case"update-success":{let{completion:t}=e;return{step:"updating",completion:{...t,completed:t.completed+1}}}case"update-error":{let{completion:s}=e;return{step:"updating",completion:{...s,completed:s.completed+1,errors:{...s.errors,[t.name]:t.error}}}}case"complete":return{...e,step:"completed"}}},N=()=>(0,p.useReducer)(b,w);var E=s(94062),T=s(99417),k=s(89398);let C=e=>{let{openWithIntent:t,onClose:s,onComplete:r,automations:o}=e,i=o.length,[a,d]=N();(0,p.useEffect)(()=>{"not-open"===t&&d({type:"reset"})},[t,d]);let[u]=(0,S.Db)(k.VE),[h]=(0,S.Db)(k.Xu),[m]=(0,S.Db)(T.Wz),[x]=(0,S.Db)(T.d0),w=async e=>{let{repoAddress:t,name:s,type:n}=e,r={repositoryLocationName:t.location,repositoryName:t.name};switch(n){case"sensor":{let{data:e}=await u({variables:{sensorSelector:{...r,sensorName:s}}});switch(e?.startSensor.__typename){case"Sensor":d({type:"update-success"});return;case"SensorNotFoundError":case"UnauthorizedError":case"PythonError":d({type:"update-error",name:s,error:e.startSensor.message})}break}case"schedule":{let{data:e}=await m({variables:{scheduleSelector:{...r,scheduleName:s}}});switch(e?.startSchedule.__typename){case"ScheduleStateResult":d({type:"update-success"});return;case"UnauthorizedError":case"PythonError":d({type:"update-error",name:s,error:e.startSchedule.message})}break}default:(0,v.UT)(n)}},b=async e=>{let{name:t,type:s,instigationState:n}=e,r={id:n.id};switch(s){case"sensor":{let{data:e}=await h({variables:r});switch(e?.stopSensor.__typename){case"StopSensorMutationResult":d({type:"update-success"});return;case"UnauthorizedError":case"PythonError":d({type:"update-error",name:t,error:e.stopSensor.message})}break}case"schedule":{let{data:e}=await x({variables:r});switch(e?.stopRunningSchedule.__typename){case"ScheduleStateResult":d({type:"update-success"});return;case"UnauthorizedError":case"PythonError":d({type:"update-error",name:t,error:e.stopRunningSchedule.message})}break}default:(0,v.UT)(s)}},C=async()=>{if("not-open"!==t){for(let e of(d({type:"start"}),o))"start"===t?await w(e):await b(e);d({type:"complete"}),r()}},$="updating"!==a.step;return(0,n.jsxs)(y.Vq,{isOpen:"not-open"!==t,title:"start"===t?"Start automations":"Stop automations",canEscapeKeyClose:$,canOutsideClickClose:$,onClose:s,children:[(0,n.jsx)(y.a7,{children:(0,n.jsxs)(f.Z,{direction:"column",spacing:24,children:[(()=>{if("not-open"===t)return null;switch(a.step){case"initial":if("stop"===t)return(0,n.jsx)("div",{children:`${1===i?"1 automation":`${i} automations`} will be stopped. Do you want to continue?`});return(0,n.jsx)("div",{children:`${1===i?"1 automation":`${i} automations`} will be started. Do you want to continue?`});case"updating":case"completed":let e=i>0?a.completion.completed/i:1;return(0,n.jsxs)(f.Z,{direction:"column",spacing:8,children:[(0,n.jsx)(j.k,{intent:"primary",value:Math.max(.1,e),animate:e<1}),"updating"===a.step?(0,n.jsx)(E.c,{message:"Automations are being updated, please do not navigate away yet."}):null]});default:return null}})(),(()=>{if("not-open"===t||"initial"===a.step)return null;if("updating"===a.step)return(0,n.jsx)("div",{children:"Please do not close the window or navigate away while automations are being updated."});let e=a.completion.errors,s=Object.keys(e).length,r=a.completion.completed-s;return(0,n.jsxs)(f.Z,{direction:"column",spacing:8,children:[r?(0,n.jsxs)(f.Z,{direction:"row",spacing:8,alignItems:"flex-start",children:[(0,n.jsx)(l.JO,{name:"check_circle",color:c.fA()}),(0,n.jsx)("div",{children:"start"===t?`Successfully started ${1===r?"1 automation":`${r} automations`}.`:`Successfully stopped ${1===r?"1 automation":`${r} automations`}.`})]}):null,s?(0,n.jsxs)(f.Z,{direction:"column",spacing:8,children:[(0,n.jsxs)(f.Z,{direction:"row",spacing:8,alignItems:"flex-start",children:[(0,n.jsx)(l.JO,{name:"warning",color:c.qr()}),(0,n.jsx)("div",{children:"start"===t?`Could not start ${1===s?"1 automation":`${s} automations`}:`:`Could not stop ${1===s?"1 automation":`${s} automations`}:`})]}),(0,n.jsx)("ul",{style:{margin:"8px 0"},children:Object.keys(e).map(t=>(0,n.jsx)("li",{children:(0,n.jsxs)(f.Z,{direction:"row",spacing:8,children:[(0,n.jsxs)("strong",{children:[t,":"]}),e[t]?(0,n.jsx)("div",{children:e[t]}):null]})},t))})]}):null]})})()]})}),(0,n.jsx)(y.cN,{children:(()=>{if("not-open"===t)return null;switch(a.step){case"initial":{let e="start"===t?`Start ${1===i?"1 automation":`${i} automations`}`:`Stop ${1===i?"1 automation":`${i} automations`}`;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.zx,{onClick:s,children:"Cancel"}),(0,n.jsx)(g.zx,{intent:"primary",onClick:C,children:e})]})}case"updating":{let e="start"===t?`Starting ${1===i?"1 automation":`${i} automations`}`:`Stopping ${1===i?"1 automation":`${i} automations`}`;return(0,n.jsx)(g.zx,{intent:"primary",disabled:!0,children:e})}case"completed":return(0,n.jsx)(g.zx,{intent:"primary",onClick:s,children:"Done"})}})()})]})};var $=s(88257);let A=e=>{let t=!1,s=!1;for(let n of e){let{status:e}=n;if(e===$.ynu.RUNNING?s=!0:e===$.ynu.STOPPED&&(t=!0),s&&t)break}return{anyOff:t,anyOn:s}},z=e=>{let{automations:t,onDone:s}=e,r=t.length,[o,i]=(0,p.useState)("not-open"),{anyOff:a,anyOn:c}=(0,p.useMemo)(()=>A(t.map(e=>{let{instigationState:t}=e;return t})),[t]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.J,{content:(0,n.jsxs)(x.v2,{children:[(0,n.jsx)(x.sN,{text:`Start ${1===r?"1 automation":`${r} automations`}`,disabled:!a,"aria-disabled":!a,icon:"toggle_on",onClick:()=>{i("start")}}),(0,n.jsx)(x.sN,{text:`Stop ${1===r?"1 automation":`${r} automations`}`,disabled:!c,"aria-disabled":!c,icon:"toggle_off",onClick:()=>{i("stop")}})]}),placement:"bottom-end",children:(0,n.jsx)(g.zx,{disabled:!r,intent:"primary",rightIcon:(0,n.jsx)(l.JO,{name:"expand_more"}),children:"Actions"})}),(0,n.jsx)(C,{openWithIntent:o,automations:t,onClose:()=>i("not-open"),onComplete:()=>{s()}})]})};var _=s(18259),M=s(43212),R=s(88510),O=s(2728),U=s(17008);let P="60px minmax(400px, 1.5fr) 240px 1fr 200px 200px",I=e=>{let{checkbox:t}=e;return(0,n.jsxs)(U.VJ,{templateColumns:P,sticky:!0,children:[(0,n.jsx)(U.qN,{children:(0,n.jsx)("div",{style:{position:"relative",top:"-1px"},children:t})}),(0,n.jsx)(U.qN,{children:"Name"}),(0,n.jsx)(U.qN,{children:"Type"}),(0,n.jsx)(U.qN,{children:"Target"}),(0,n.jsx)(U.qN,{children:"Last tick"}),(0,n.jsx)(U.qN,{children:"Last run"})]})},L=(0,O.ZP)(r.x).withConfig({componentId:"sc-40d0a0cf-0"})(["display:grid;grid-template-columns:",";height:100%;"],P);var q=s(58495),D=s(37504),F=s(53664),Y=s(47933),Z=s(24427),V=s(16336),G=s(60648),J=s(90441);let K=e=>{let t=Intl.DateTimeFormat(navigator.language,{timeZone:e,timeZoneName:"shortOffset"}),s=t.formatToParts(new Date).find(e=>"timeZoneName"===e.type)?.value,n=s?.replace("GMT","");if(!n)return 0;let[r="0",o="0"]=n.split(":"),i=parseInt(r,10),a=parseInt(o,10)/60*(i<0?-1:1);return i+a};var X=s(89516),W=s(68903),H=s(72045);let B=e=>{let{cronSchedule:t,executionTimezone:s}=e,{timezone:[r]}=(0,p.useContext)(W.JB),o=s||"UTC",i=(0,X.A)(t,{longTimezoneName:o}),l="Automatic"===r?(0,H.cw)():r,c=K(l),d=K(o),u=(0,X.A)(t,{longTimezoneName:l,tzOffset:c-d}),m=(0,n.jsx)(J.nZ,{rows:[{key:"Cron value",value:(0,n.jsx)(a.aU,{children:t})},{key:"Your time",value:(0,n.jsx)("span",{children:u})}]});return(0,n.jsx)(Q,{children:(0,n.jsx)(h.u,{content:m,placement:"top",children:(0,n.jsx)(M.V,{icon:"schedule",children:i})})})},Q=O.ZP.div.withConfig({componentId:"sc-3e257bcf-0"})([".bp5-popover-target{max-width:100%;&:focus{outline:none;}}"]);var ee=s(6750),et=s(4219);let es=(e,t)=>{if(e===$.ynu.STOPPED&&0===t||e===$.ynu.RUNNING&&1===t)return null;let s=[];return e===$.ynu.RUNNING&&0===t?s.push("Schedule is set to be running, but either the scheduler is not configured or the scheduler is not running the schedule"):e===$.ynu.STOPPED&&t>0&&s.push("Schedule is set to be stopped, but the scheduler is still running the schedule"),t>0&&s.push("Duplicate cron job for schedule found."),(0,n.jsx)(m.J,{interactionKind:"hover",popoverClassName:"bp5-popover-content-sizing",position:"right",content:(0,n.jsxs)(r.x,{flex:{direction:"column",gap:8},padding:12,children:[(0,n.jsx)("strong",{children:"There are errors with this schedule."}),(0,n.jsx)("div",{children:"Errors:"}),(0,n.jsx)("ul",{children:s.map((e,t)=>(0,n.jsx)("li",{children:e},t))})]}),children:(0,n.jsx)(M.V,{fill:!0,interactive:!0,intent:"danger",children:"Error"})})};var en=s(86269),er=s(58905),eo=s(83738);s(92199);var ei=s(10539),ea=s(77837),el=s(33182);s(43);let ec="1.2fr 1fr 1fr 76px 148px 210px 92px",ed=`60px ${ec}`;(0,O.ZP)(r.x).withConfig({componentId:"sc-d3e9c59a-0"})(["display:grid;grid-template-columns:",";height:100%;"],e=>{let{$showCheckboxColumn:t}=e;return t?ed:ec});let eu=(0,S.Ps)`
  query SingleScheduleQuery($selector: ScheduleSelector!) {
    scheduleOrError(scheduleSelector: $selector) {
      ... on Schedule {
        id
        name
        pipelineName
        description
        scheduleState {
          id
          runningCount
          hasStartPermission
          hasStopPermission
          ticks(limit: 1) {
            id
            ...TickTagFragment
          }
          runs(limit: 1) {
            id
            ...RunTimeFragment
          }
          nextTick {
            timestamp
          }
        }
        partitionSet {
          id
          name
        }
        ...ScheduleSwitchFragment
      }
    }
  }

  ${ea.dY}
  ${el.$X}
  ${et.J}
`,eh=(0,p.forwardRef)((e,t)=>{let{index:s,name:o,repoAddress:i,checked:l,onToggleChecked:c}=e,d=(0,q.F)(100),u=(0,S.aM)(eu,{variables:{selector:{repositoryName:i.name,repositoryLocationName:i.location,scheduleName:o}},skip:!d,notifyOnNetworkStatusChange:!0}),m=(0,S.aM)(ee.d,{variables:{scheduleSelector:{repositoryName:i.name,repositoryLocationName:i.location,scheduleName:o}},skip:!d});(0,V.C4)(u,V.dT),(0,V.C4)(m,V.dT);let{data:x}=u,g=(0,p.useMemo)(()=>x?.scheduleOrError.__typename!=="Schedule"?null:x.scheduleOrError,[x]),j=g?.scheduleState,f=(0,p.useMemo)(()=>{if(!j)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:s}=j;return s!==$.ynu.RUNNING||t?s!==$.ynu.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this schedule"}:{disabled:!0,message:"You do not have permission to stop this schedule"}},[j]),y=g?.scheduleState.ticks[0],v=g?.pipelineName?[{pipelineName:g.pipelineName}]:null,w=m.data?.scheduleOrError.__typename==="Schedule"?m.data.scheduleOrError.assetSelection:null;return(0,n.jsx)("div",{ref:t,"data-index":s,children:(0,n.jsxs)(L,{border:"bottom",children:[(0,n.jsx)(U.E5,{children:(0,n.jsx)(h.u,{canShow:f.disabled,content:f.message||"",placement:"top",children:(0,n.jsx)(D.X,{disabled:f.disabled,checked:l,onChange:e=>{if(c&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;c({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,n.jsx)(U.E5,{children:(0,n.jsx)(r.x,{flex:{direction:"row",gap:8,alignItems:"flex-start",justifyContent:"space-between"},children:(0,n.jsxs)(r.x,{flex:{grow:1,gap:8},children:[g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(et.M,{repoAddress:i,schedule:g},o),es(g.scheduleState.status,g.scheduleState.runningCount)]}):(0,n.jsx)("div",{style:{width:30}}),(0,n.jsx)(Y.rU,{to:(0,ei.$U)(i,`/schedules/${o}`),children:(0,n.jsx)(F.g,{text:o})})]})})}),(0,n.jsx)(U.E5,{children:g?(0,n.jsxs)(r.x,{flex:{direction:"column",gap:4},children:[(0,n.jsx)(B,{cronSchedule:g.cronSchedule,executionTimezone:g.executionTimezone}),g.scheduleState.nextTick&&g.scheduleState.status===$.ynu.RUNNING?(0,n.jsx)(a.YS,{children:(0,n.jsxs)("div",{style:{overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%",textOverflow:"ellipsis"},children:["Next tick:\xa0",(0,n.jsx)(en.v,{timestamp:g.scheduleState.nextTick.timestamp,timezone:g.executionTimezone,timeFormat:{showSeconds:!1,showTimezone:!0}})]})}):null]}):(0,n.jsx)(eo.mq,{queryResult:u})}),(0,n.jsx)(U.E5,{children:(0,n.jsx)("div",{children:(0,n.jsx)(Z.p,{repoAddress:i,automationType:"schedule",targets:v,assetSelection:w})})}),(0,n.jsx)(U.E5,{children:y?(0,n.jsx)("div",{children:(0,n.jsx)(er.a,{tick:y,tickResultType:"runs"})}):(0,n.jsx)(eo.mq,{queryResult:u})}),(0,n.jsx)(U.E5,{children:g?.scheduleState&&g?.scheduleState.runs[0]?(0,n.jsx)(G.Z,{run:g.scheduleState.runs[0],name:o,showButton:!1,showHover:!0,showSummary:!1}):(0,n.jsx)(eo.mq,{queryResult:u})})]})})});var ep=s(68856),em=s(60918);s(50494);let ex="1.5fr 180px 1fr 76px 120px 148px 180px",eg=`60px ${ex}`;(0,O.ZP)(r.x).withConfig({componentId:"sc-ca4f930b-0"})(["display:grid;grid-template-columns:",";height:100%;"],e=>{let{$showCheckboxColumn:t}=e;return t?eg:ex});let ej={[$.dEY.ASSET]:{name:"Asset sensor",icon:"sensors",description:"Asset sensors instigate runs when a materialization occurs"},[$.dEY.AUTO_MATERIALIZE]:{name:"Automation condition sensor",icon:"automation_condition",description:"Automation condition sensors trigger runs based on conditions defined on assets or checks."},[$.dEY.AUTOMATION]:{name:"Automation condition sensor",icon:"automation_condition",description:"Automation condition sensors trigger runs based on conditions defined on assets or checks."},[$.dEY.FRESHNESS_POLICY]:{name:"Freshness policy sensor",icon:"sensors",description:"Freshness sensors check the freshness of assets on each tick, then perform an action in response to that status"},[$.dEY.MULTI_ASSET]:{name:"Multi-asset sensor",icon:"sensors",description:"Multi asset sensors trigger job executions based on multiple asset materialization event streams"},[$.dEY.RUN_STATUS]:{name:"Run status sensor",icon:"sensors",description:"Run status sensors react to run status"},[$.dEY.STANDARD]:{name:"Standard sensor",icon:"sensors",description:null},[$.dEY.UNKNOWN]:{name:"Standard sensor",icon:"sensors",description:null}},ef=(0,S.Ps)`
  query SingleSensorQuery($selector: SensorSelector!) {
    sensorOrError(sensorSelector: $selector) {
      ... on Sensor {
        id
        description
        name
        targets {
          pipelineName
        }
        metadata {
          assetKeys {
            path
          }
        }
        minIntervalSeconds
        description
        sensorState {
          id
          runningCount
          hasStartPermission
          hasStopPermission
          ticks(limit: 1) {
            id
            ...TickTagFragment
          }
          runs(limit: 1) {
            id
            ...RunTimeFragment
          }
          nextTick {
            timestamp
          }
        }
        ...SensorSwitchFragment
      }
    }
  }

  ${ea.dY}
  ${el.$X}
  ${em.U}
`,ey=(0,p.forwardRef)((e,t)=>{let{index:s,name:o,repoAddress:i,checked:a,onToggleChecked:l}=e,c=(0,q.F)(100),d=(0,S.aM)(ef,{variables:{selector:{repositoryName:i.name,repositoryLocationName:i.location,sensorName:o}},skip:!c}),u=(0,S.aM)(ep.Z,{variables:{sensorSelector:{repositoryName:i.name,repositoryLocationName:i.location,sensorName:o}},skip:!c});(0,V.C4)(d,V.dT),(0,V.C4)(u,V.dT);let{data:m}=d,x=(0,p.useMemo)(()=>m?.sensorOrError.__typename!=="Sensor"?null:m.sensorOrError,[m]),g=x?.sensorState,j=(0,p.useMemo)(()=>{if(!g)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:s}=g;return s!==$.ynu.RUNNING||t?s!==$.ynu.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this sensor"}:{disabled:!0,message:"You do not have permission to stop this sensor"}},[g]),f=x?.sensorState.ticks[0],y=x?.sensorType,v=y?ej[y]:null,w=u.data?.sensorOrError.__typename==="Sensor"?u.data.sensorOrError.assetSelection:null;return(0,n.jsx)("div",{ref:t,"data-index":s,children:(0,n.jsxs)(L,{border:"bottom",children:[(0,n.jsx)(U.E5,{children:(0,n.jsx)(h.u,{canShow:j.disabled,content:j.message||"",placement:"top",children:(0,n.jsx)(D.X,{disabled:j.disabled,checked:a,onChange:e=>{if(l&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;l({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,n.jsx)(U.E5,{children:(0,n.jsx)(r.x,{flex:{direction:"row",gap:8,alignItems:"flex-start",justifyContent:"space-between"},children:(0,n.jsxs)(r.x,{flex:{grow:1,gap:8},children:[x?(0,n.jsx)(em.c,{repoAddress:i,sensor:x},o):(0,n.jsx)("div",{style:{width:30}}),(0,n.jsx)(Y.rU,{to:(0,ei.$U)(i,`/sensors/${o}`),children:(0,n.jsx)(F.g,{text:o})})]})})}),(0,n.jsx)(U.E5,{children:(0,n.jsx)("div",{children:v?v.description?(0,n.jsx)(h.u,{content:(0,n.jsx)("div",{style:{maxWidth:"300px"},children:v.description}),placement:"top",children:(0,n.jsx)(M.V,{icon:v.icon,children:v.name})}):(0,n.jsx)(M.V,{icon:v.icon,children:v.name}):null})}),(0,n.jsx)(U.E5,{children:x?(0,n.jsx)("div",{children:(0,n.jsx)(Z.p,{targets:x.targets||null,repoAddress:i,assetSelection:w,automationType:x.sensorType})}):(0,n.jsx)(eo.mq,{queryResult:u})}),(0,n.jsx)(U.E5,{children:f?(0,n.jsx)("div",{children:(0,n.jsx)(er.a,{tick:f,tickResultType:"runs"})}):(0,n.jsx)(eo.mq,{queryResult:d})}),(0,n.jsx)(U.E5,{children:x?.sensorState&&x?.sensorState.runs[0]?(0,n.jsx)(G.Z,{run:x.sensorState.runs[0],name:o,showButton:!1,showHover:!0,showSummary:!1}):(0,n.jsx)(eo.mq,{queryResult:d})})]})})});var eS=s(22921),ev=s(22563);let ew=(e,t)=>`${(0,ev.Uz)(e)}-${t}`;var eb=s(98956),eN=s(50646);let eE=e=>{let{repos:t,headerCheckbox:s,checkedKeys:o,onToggleCheckFactory:i}=e,a=p.useRef(null),l=p.useMemo(()=>t.map(e=>{let{repoAddress:t}=e;return(0,ev.Uz)(t)}),[t]),{expandedKeys:c,onToggle:d,onToggleAll:u}=(0,eN.N)(eS.y,l),m=p.useMemo(()=>{let e=[];return t.forEach(t=>{let{repoAddress:s,schedules:n,sensors:r}=t;e.push({type:"header",repoAddress:s,scheduleCount:n.length,sensorCount:r.length});let o=(0,ev.Uz)(s);if(c.includes(o)){let t=new Set(r),o=new Set(n);[...r,...n].sort((e,t)=>v.Bl.compare(e,t)).forEach(n=>{t.has(n)?e.push({type:"sensor",repoAddress:s,sensor:n}):o.has(n)&&e.push({type:"schedule",repoAddress:s,schedule:n})})}}),e},[t,c]),x=(0,eb.w)(t.map(e=>{let{repoAddress:t}=e;return t.name})),g=(0,R.MG)({count:m.length,getScrollElement:()=>a.current,estimateSize:e=>{let t=m[e];return t?.type==="header"?32:64},overscan:15}),j=g.getTotalSize(),f=g.getVirtualItems();return(0,n.jsx)("div",{style:{overflow:"hidden"},children:(0,n.jsxs)(U.W2,{ref:a,children:[(0,n.jsx)(I,{checkbox:s}),(0,n.jsx)(U.Nh,{$totalHeight:j,children:f.map(e=>{let{index:t,key:s,size:a,start:l}=e,p=m[t],j=p.type;if("header"===j)return(0,n.jsx)(_.X2,{$height:a,$start:l,children:(0,n.jsx)(eo._$,{repoAddress:p.repoAddress,ref:g.measureElement,index:t,onToggle:d,onToggleAll:u,expanded:c.includes((0,ev.Uz)(p.repoAddress)),showLocation:x.has(p.repoAddress.name),rightElement:(0,n.jsxs)(r.x,{flex:{direction:"row",gap:4},children:[(0,n.jsx)(h.u,{content:1===p.sensorCount?"1 sensor":`${p.sensorCount} sensors`,placement:"top",children:(0,n.jsx)(M.V,{icon:"sensors",children:p.sensorCount})}),(0,n.jsx)(h.u,{content:1===p.scheduleCount?"1 schedule":`${p.scheduleCount} schedules`,placement:"top",children:(0,n.jsx)(M.V,{icon:"schedule",children:p.scheduleCount})})]})},s)},s);if("sensor"===j){let e=ew(p.repoAddress,p.sensor);return(0,n.jsx)(_.X2,{$height:a,$start:l,children:(0,n.jsx)(ey,{index:t,ref:g.measureElement,name:p.sensor,checked:o.has(e),onToggleChecked:i(e),repoAddress:p.repoAddress},s)},s)}if("schedule"===j){let e=ew(p.repoAddress,p.schedule);return(0,n.jsx)(_.X2,{$height:a,$start:l,children:(0,n.jsx)(eh,{index:t,ref:g.measureElement,name:p.schedule,checked:o.has(e),onToggleChecked:i(e),repoAddress:p.repoAddress},s)},s)}return(0,n.jsx)("div",{},s)})})]})})};var eT=s(69737),ek=s(20171),eC=s(4378),e$=s(52154);let eA=e=>e.hasStartPermission&&e.status===$.ynu.STOPPED||e.hasStopPermission&&e.status===$.ynu.RUNNING;var ez=s(907),e_=s(49455),eM=s(97211),eR=s(74548),eO=s(2389),eU=s(90723),eP=s(50027),eI=s(59030);let eL=()=>{let[e,t]=(0,eC.q)({encode:e=>({instigationStatus:e.size?Array.from(e).join(","):void 0}),decode:e=>new Set(e.instigationStatus?.split(",")||[])});return(0,eR.im)({name:"Running state",icon:"toggle_off",allValues:[{value:$.ynu.RUNNING,match:["on","running"]},{value:$.ynu.STOPPED,match:["off","stopped"]}],getKey:e=>e,renderLabel:e=>{let{value:t}=e;return(0,n.jsx)("span",{children:t===$.ynu.RUNNING?"Running":"Stopped"})},state:e,onStateChanged:t,getStringValue:e=>e})};var eq=s(17867),eD=s(65822);let eF={schedules:{label:"Schedules",value:{type:"schedules",label:"Schedules"},match:["schedules"]},sensors:{label:"Sensors",value:{type:"sensors",label:"Sensors"},match:["sensors"]}},eY=Object.values(eF),eZ=()=>{(0,eT.Px)(),(0,ek.j)("Automation");let{allRepos:e,visibleRepos:t,loading:s,data:m,refetch:x}=(0,p.useContext)(eq.C5),[g,j]=(0,eC.q)({queryKey:"search",defaults:{search:""}}),[f,y]=(0,eC.q)({encode:e=>({automationType:e.size?Array.from(e).join(","):void 0}),decode:e=>new Set(e.automationType?.split(",")||[])}),S=(0,p.useMemo)(()=>new Set(Array.from(f).map(e=>eF[e].value)),[f]),v=(0,eP.A)(),w=eL(),b=(0,eR.im)({name:"Automation type",allValues:eY,icon:"automation_condition",getStringValue:e=>e.label,state:S,renderLabel:e=>{let{value:t}=e;return(0,n.jsx)("span",{children:t.label})},onStateChanged:e=>{y(new Set(Array.from(e).map(e=>e.type)))}}),N=(0,p.useMemo)(()=>{let e=Object.values(m).filter(e=>"WorkspaceLocationEntry"===e.__typename),s=(0,e_.S)(t);return eG(e).filter(e=>{let{repoAddress:t}=e;return s.has((0,ev.Uz)(t))})},[m,t]),E=(0,eI.in)({allTags:(0,eI.gP)(N,(0,p.useCallback)(e=>[...e.schedules.flatMap(e=>e.tags),...e.sensors.flatMap(e=>e.tags)],[]))}),{state:T}=E,k=(0,p.useMemo)(()=>[v,w,b,E],[v,w,b,E]),{button:C,activeFiltersJsx:$}=(0,eM.m)({filters:k}),{state:A}=w,_=(0,p.useMemo)(()=>N.map(e=>{let{sensors:t,schedules:s,...n}=e;return{...n,sensors:t.filter(e=>{let{sensorState:t,tags:s}=e;return(!T.size||!!(0,eU.w)(Array.from(T),s))&&(!A.size||!!A.has(t.status))&&(!f.size||!!f.has("sensors"))}),schedules:s.filter(e=>{let{scheduleState:t,tags:s}=e;return(!T.size||!!(0,eU.w)(Array.from(T),s))&&(!A.size||!!A.has(t.status))&&(!f.size||!!f.has("schedules"))})}}),[N,T,A,f]),M=g.trim().toLocaleLowerCase(),R=M.length>0,O=(0,p.useMemo)(()=>{let e=M.toLocaleLowerCase();return _.map(t=>{let{repoAddress:s,schedules:n,sensors:r}=t;return{repoAddress:s,schedules:n.filter(t=>{let{name:s}=t;return s.toLocaleLowerCase().includes(e)}).map(e=>{let{name:t}=e;return t}),sensors:r.filter(t=>{let{name:s}=t;return s.toLocaleLowerCase().includes(e)}).map(e=>{let{name:t}=e;return t})}}).filter(e=>{let{sensors:t,schedules:s}=e;return t.length>0||s.length>0})},[_,M]),U=(0,p.useMemo)(()=>_.map(e=>{let{repoAddress:t,schedules:s,sensors:n}=e;return[...n.filter(e=>{let{sensorState:t}=e;return eA(t)}).map(e=>{let{name:s,sensorState:n}=e;return{repoAddress:t,name:s,type:"sensor",instigationState:n}}),...s.filter(e=>{let{scheduleState:t}=e;return eA(t)}).map(e=>{let{name:s,scheduleState:n}=e;return{repoAddress:t,name:s,type:"schedule",instigationState:n}})]}).flat(),[_]),P=(0,p.useMemo)(()=>U.map(e=>{let{repoAddress:t,name:s}=e;return ew(t,s)}),[U]),[{checkedIds:I},{onToggleFactory:L,onToggleAll:q}]=(0,e$.a)(P),D=(0,p.useMemo)(()=>{let e=new Set(O.map(e=>{let{repoAddress:t,schedules:s,sensors:n}=e;return[...s,...n].map(e=>ew(t,e))}).flat());return P.filter(t=>e.has(t))},[P,O]),F=(0,p.useMemo)(()=>{let e=new Set(D.filter(e=>I.has(e)));return U.filter(t=>{let{repoAddress:s,name:n}=t;return e.has(ew(s,n))})},[D,U,I]),Y=P.length>0,Z=F.length,V=D.length>0;return(0,n.jsxs)(r.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,n.jsx)(d.m,{title:(0,n.jsx)(a.X6,{children:"Automation"})}),(0,n.jsxs)(r.x,{padding:{horizontal:24,vertical:12},flex:{direction:"row",alignItems:"center",justifyContent:"space-between",gap:12,grow:0},children:[(0,n.jsxs)(r.x,{flex:{direction:"row",gap:12},children:[C,(0,n.jsx)(u.oi,{icon:"search",value:g,onChange:e=>j(e.target.value),placeholder:"Filter by name…",style:{width:"340px"}})]}),(0,n.jsx)(h.u,{content:"You do not have permission to start or stop these schedules",canShow:V&&!Y,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,n.jsx)(z,{automations:F,onDone:()=>x()})})]}),$.length?(0,n.jsx)(r.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:$}):null,(()=>{if(s)return(0,n.jsx)(r.x,{flex:{direction:"row",justifyContent:"center"},padding:{top:64},children:(0,n.jsx)(o.f,{label:"Loading automations…"})});let d=e.length>t.length;return O.length?(0,n.jsx)(eE,{headerCheckbox:Y?(0,n.jsx)(eO.W,{checkedCount:Z,totalCount:D.length,onToggleAll:q}):void 0,repos:O,checkedKeys:I,onToggleCheckFactory:L}):R?(0,n.jsx)(r.x,{padding:{top:20},children:(0,n.jsx)(i.t,{icon:"search",title:"No matching automations",description:d?(0,n.jsxs)("div",{children:["No automations matching ",(0,n.jsx)("strong",{children:g})," were found in the selected code locations"]}):(0,n.jsxs)("div",{children:["No automations matching ",(0,n.jsx)("strong",{children:g})," were found in your definitions"]})})}):(0,n.jsx)(r.x,{padding:{top:20},children:(0,n.jsx)(i.t,{icon:"search",title:"No automations",description:d?"No automations were found in the selected code locations":(0,n.jsxs)(a.pN,{children:["There are no automations in this deployment."," ",(0,n.jsx)("a",{href:"https://docs.dagster.io/concepts/automation",target:"_blank",rel:"noreferrer",children:(0,n.jsxs)(r.x,{flex:{direction:"row",gap:4,alignItems:"center"},children:["Learn more about automations",(0,n.jsx)(l.JO,{name:"open_in_new",color:c.Es()})]})})]})})})})()]})};var eV=eZ;let eG=e=>{let t=e.map(e=>e.locationOrLoadError),s=[];for(let e of t)if(e?.__typename==="RepositoryLocation")for(let t of e.repositories){let{name:n,schedules:r,sensors:o}=t,i=(0,eD.kQ)(n,e.name);(o.length>0||r.length>0)&&s.push({repoAddress:i,schedules:r,sensors:o})}return(0,ez.S)(s)}},907:function(e,t,s){s.d(t,{S:function(){return r}});var n=s(22563);let r=e=>[...e].sort((e,t)=>{let s=(0,n.Uz)(e.repoAddress),r=(0,n.Uz)(t.repoAddress);return s.localeCompare(r)})},49455:function(e,t,s){s.d(t,{S:function(){return o}});var n=s(65822),r=s(22563);let o=e=>new Set(e.map(e=>(0,r.Uz)((0,n.kQ)(e.repository.name,e.repositoryLocation.name))))}}]);
//# sourceMappingURL=6749.0113a1ceb811b2bf.js.map